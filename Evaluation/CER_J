## pip install openai-whisper jiwer

import whisper
import jiwer

# 1. ì›ë³¸ ë¬¸ì¥ (TTS ì…ë ¥ì— ì‚¬ìš©í•œ í…ìŠ¤íŠ¸)
reference_text = "ì•ˆë…•í•˜ì„¸ìš”. ì˜¤ëŠ˜ì€ ì¸ê³µì§€ëŠ¥ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ë³¼ê²Œìš”."

# 2. Whisper ëª¨ë¸ ë¡œë“œ (base ëª¨ë¸ì´ë©´ ë¹ ë¥´ê³  ì¶©ë¶„íˆ ì •í™•í•¨)
model = whisper.load_model("base")

# 3. í•©ì„±ëœ ìŒì„± íŒŒì¼ì„ STTë¡œ í…ìŠ¤íŠ¸ ë³€í™˜
result = model.transcribe("synthesized.wav", language="ko")
hypothesis_text = result["text"].strip()

print("ğŸ”¹ TTS ì›ë¬¸:", reference_text)
print("ğŸ”¸ STT ê²°ê³¼:", hypothesis_text)

# 4. CER ê³„ì‚° (ì „ì²˜ë¦¬ ì ìš©)
transformation = jiwer.Compose([
    jiwer.RemovePunctuation(),
    jiwer.Strip(),
    jiwer.ToLowerCase()
])

measures = jiwer.compute_measures(
    reference_text, hypothesis_text,
    truth_transform=transformation,
    hypothesis_transform=transformation
)

print("âœ… CER (Character Error Rate):", measures["cer"])
